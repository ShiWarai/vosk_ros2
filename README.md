# vosk_ros2
–ü–∞–∫–µ—Ç ROS 2 –¥–ª—è –∑–∞–ø—É—Å–∫–∞ STT –Ω–æ–¥—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ Vosk

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –ø–∞–∫–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–∑–µ–ª ROS 2 –¥–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Vosk. –û–Ω –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ [whisper_ros](https://github.com/mgonzs13/whisper_ros) –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Vosk –∏ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è GPU.

### –û—Å–Ω–æ–≤–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è –æ—Ç whisper_ros:
- **–î–≤–∏–∂–æ–∫ STT**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç [Vosk](https://alphacephei.com/vosk/) –≤–º–µ—Å—Ç–æ Whisper.cpp.
- **–ë–µ–∑ GPU**: –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ CPU, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç CUDA –∏–ª–∏ ONNX Runtime —Å GPU.
- **–ê—É–¥–∏–æ–≤—Ö–æ–¥**: –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ ROS2 —Ç–æ–ø–∏–∫ `/audio/input` (–ø—É–±–ª–∏–∫—É–µ—Ç—Å—è `audio_capturer_node` –∏–∑ –ø–∞–∫–µ—Ç–∞ `audio_common`).
- **VAD**: –†–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ, –±–µ–∑ Voice Activity Detection (VAD).
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ `whisper_msgs` (`Transcription.msg`, `STT.action`) –¥–ª—è –ª–µ–≥–∫–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.
- **–ú–æ–¥–µ–ª—å**: –ú–æ–¥–µ–ª—å Vosk –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –ï—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–∞—á–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ.

## üöÄ –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø—Ä–æ–µ–∫—Ç—ã

### Vosk
- **–û–ø–∏—Å–∞–Ω–∏–µ**: Vosk - —ç—Ç–æ –æ—Ñ—Ñ–ª–∞–π–Ω-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è –±–æ–ª–µ–µ 20 —è–∑—ã–∫–æ–≤. –û–Ω–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±—ã—Å—Ç—Ä—É—é –∏ —Ç–æ—á–Ω—É—é —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é —Ä–µ—á–∏ –Ω–∞ CPU.
- **–õ–∏—Ü–µ–Ω–∑–∏—è**: Apache 2.0
- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: [https://github.com/alphacephei/vosk-api](https://github.com/alphacephei/vosk-api)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [https://alphacephei.com/vosk/](https://alphacephei.com/vosk/)

Vosk –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç Python API –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ü–∞–∫–µ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥–µ–ª—å `vosk-model-small-ru` –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä—É—Å—Å–∫–æ–π —Ä–µ—á–∏.

### whisper_ros
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç ROS 2 –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Whisper.cpp (STT) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SileroVAD. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–∞–∫ –æ—Å–Ω–æ–≤–∞ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–∫–µ—Ç–∞ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ ROS2.
- **–ê–≤—Ç–æ—Ä**: Miguel √Ångel Gonz√°lez Santamarta
- **–õ–∏—Ü–µ–Ω–∑–∏—è**: MIT
- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: [https://github.com/mgonzs13/whisper_ros](https://github.com/mgonzs13/whisper_ros)

–ü–∞–∫–µ—Ç `vosk_ros2` —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã `whisper_ros`, –Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Vosk –≤–º–µ—Å—Ç–æ Whisper. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (—Å–æ–æ–±—â–µ–Ω–∏—è –∏ –¥–µ–π—Å—Ç–≤–∏—è) –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º.

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- Python –ø–∞–∫–µ—Ç—ã:
  - `vosk` - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏
  - `numpy` - —Ä–∞–±–æ—Ç–∞ —Å –º–∞—Å—Å–∏–≤–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
  - `rclpy` - ROS2 Python –∫–ª–∏–µ–Ω—Ç

- ROS2 –ø–∞–∫–µ—Ç—ã:
  - `std_msgs` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è ROS2
  - `rosidl_default_generators` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
  - `audio_common_msgs` - —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∞—É–¥–∏–æ

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é src –≤–∞—à–µ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ ROS2
cd ~/ros2_ws/src

# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository_url>

# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
cd ~/ros2_ws

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
rosdep install --from-paths src --ignore-src -r -y

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip3 install vosk numpy

# –°–æ–±–µ—Ä–∏—Ç–µ –ø–∞–∫–µ—Ç
colcon build --packages-select vosk_ros2

# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ ROS2
source install/setup.bash
```

## –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ Vosk

–ú–æ–¥–µ–ª—å Vosk –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–∑-–∑–∞ –±–æ–ª—å—à–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞. –í–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–∞—á–∞—Ç—å –µ—ë –≤—Ä—É—á–Ω—É—é.

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç Vosk:**
   [https://alphacephei.com/vosk/models](https://alphacephei.com/vosk/models)

2. **–°–∫–∞—á–∞–π—Ç–µ –Ω—É–∂–Ω—É—é –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `vosk-model-small-ru-0.22.zip`):**
   ```bash
   wget https://alphacephei.com/vosk/models/vosk-model-small-ru-0.22.zip
   ```

3. **–†–∞—Å–ø–∞–∫—É–π—Ç–µ –º–æ–¥–µ–ª—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `models` –≤–Ω—É—Ç—Ä–∏ –ø–∞–∫–µ—Ç–∞ `vosk_ros2`:**
   ```bash
   unzip vosk-model-small-ru-0.22.zip -d ~/ros2_ws/src/vosk_ros2/models/
   # –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç—å –∫ –º–æ–¥–µ–ª–∏ –≤–Ω—É—Ç—Ä–∏ –ø–∞–∫–µ—Ç–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
   # ~/ros2_ws/src/vosk_ros2/models/vosk-model-small-ru
   ```
   –ò–ª–∏ —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `model_path` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —É–∑–ª–∞.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —É–∑–ª–∞

**–í–∞–∂–Ω–æ**: –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º `vosk_node` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å `audio_capturer_node`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∞—É–¥–∏–æ –≤ —Ç–æ–ø–∏–∫ `/audio/input`:

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ audio_capturer_node
ros2 launch rds_2p audio_nodes.launch.py

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: –ó–∞–ø—É—Å—Ç–∏—Ç–µ vosk_node
ros2 launch vosk_ros2 vosk.launch.py
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞

- `model_path` - –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –º–æ–¥–µ–ª–∏ Vosk (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å –∏–∑ –ø–∞–∫–µ—Ç–∞)
- `audio_topic` - ROS2 —Ç–æ–ø–∏–∫ –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `/audio/input`)
- `transcription_topic` - –∏–º—è —Ç–æ–ø–∏–∫–∞ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `/audio/transcription`)

### –ü—Ä–∏–º–µ—Ä —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

```bash
ros2 launch vosk_ros2 vosk.launch.py \
    audio_topic:="/my_audio_topic" \
    transcription_topic:="/my_transcription_topic"
```

## –¢–æ–ø–∏–∫–∏

- `/audio/input` (`audio_common_msgs/msg/AudioStamped`) - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `audio_topic`)
- `/audio/transcription` (`vosk_ros2/msg/Transcription`) - –ø—É–±–ª–∏–∫—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `transcription_topic`)

## –î–µ–π—Å—Ç–≤–∏—è (Actions)

- `/vosk/listen` (`vosk_ros2/action/STT`) - –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏

## –°–æ–æ–±—â–µ–Ω–∏—è

### Transcription
- `text` (string) - —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
- `audio_time` (float32) - –≤—Ä–µ–º—è –∞—É–¥–∏–æ
- `transcription_time` (float32) - –≤—Ä–µ–º—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## üë• –ê–≤—Ç–æ—Ä—ã

- Zhuravliov Pavel (zhuravliov.pav@yandex.ru)
